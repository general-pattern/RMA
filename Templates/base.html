<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}RMA System{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="header-left">
        <a href="{{ url_for('index') }}" class="logo-link">
          <div class="app-title">RMA System</div>
          <div class="app-subtitle">Returns & Rework Tracking</div>
        </a>
      </div>
      
      <nav class="app-nav">
        <a href="{{ url_for('index') }}" class="nav-link">Dashboard</a>
        
        <!-- RMAs Dropdown -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn">RMAs <span class="dropdown-arrow">â–¼</span></button>
          <div class="nav-dropdown-content">
            <a href="{{ url_for('new_rma') }}">â• New RMA</a>
            <a href="{{ url_for('list_rmas') }}">ğŸ“‹ All RMAs</a>
            <!-- Status filters -->
            <a href="{{ url_for('list_rmas', status='Draft') }}">ğŸŸ¡ Draft</a>
            <a href="{{ url_for('list_rmas', status='Acknowledged') }}">ğŸ”µ Acknowledged</a>
            <a href="{{ url_for('list_rmas', status='In Progress') }}">ğŸŸ  In Progress</a>
            <a href="{{ url_for('list_rmas', status='Rejected') }}">âš« Rejected</a>
            <a href="{{ url_for('list_rmas', status='Closed') }}">ğŸ”´ Closed</a>
          </div>
        </div>
        
        <a href="{{ url_for('metrics') }}" class="nav-link">ğŸ“Š Metrics</a>
        
        <!-- Admin Dropdown -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn">Admin <span class="dropdown-arrow">â–¼</span></button>
          <div class="nav-dropdown-content">
            {% if current_user and current_user['Role'] == 'admin' %}
            <a href="{{ url_for('admin_users') }}">ğŸ‘¥ Manage Users</a>
            <a href="{{ url_for('register') }}">â• Add User</a>
            <div style="border-top: 1px solid var(--gray-200); margin: 5px 0;"></div>
            {% endif %}
            <a href="{{ url_for('list_customers') }}">ğŸ¢ Customers</a>
            <a href="{{ url_for('list_owners') }}">ğŸ‘¤ Internal Owners</a>
          </div>
        </div>
        
        <!-- User Menu -->
        {% if current_user %}
        <div class="nav-dropdown user-menu">
          <button class="nav-dropdown-btn user-btn">
            <span class="user-avatar">{{ current_user['FullName'][0] }}</span>
            {{ current_user['FullName'] }}
            <span class="dropdown-arrow">â–¼</span>
          </button>
          <div class="nav-dropdown-content">
            <a href="{{ url_for('profile') }}">âš™ï¸ Profile</a>
            <a href="{{ url_for('notification_preferences') }}">ğŸ“§ Notifications</a>
            <a href="{{ url_for('logout') }}" class="logout-link">ğŸšª Logout</a>
          </div>
        </div>
        {% endif %}
      </nav>
    </header>

            <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-container">
          {% for category, message in messages %}
            <div class="flash-message flash-{{ category }}">
              <span class="flash-text">{{ message }}</span>

              <div class="flash-actions">
                {% if session.get('last_undo') %}
                <form method="post"
                      action="{{ url_for('undo_last') }}"
                      class="flash-undo-form">
                  <!-- Unicode circular arrow icon -->
                  <button type="submit"
                          class="flash-icon-btn flash-undo-btn"
                          title="Undo last action">
                    â†º
                  </button>
                </form>
                {% endif %}

                <button class="flash-icon-btn flash-close"
                        onclick="this.parentElement.parentElement.remove()"
                        title="Dismiss">
                  Ã—
                </button>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}



    <main>
      {% block content %}{% endblock %}
    </main>
    
    <footer class="app-footer">
      <p>RMA System &copy; {{ now().year if now is defined else '2024' }}</p>
    </footer>
  </div>
</body>
</html>
