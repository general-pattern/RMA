{% extends "base.html" %}
{% block content %}

<div class="page-header">
  <h2>ğŸ“§ Email Notification Preferences</h2>
</div>

{% if not is_owner %}
<div class="card" style="max-width: 600px;">
  <div style="background-color: #fef3c7; padding: 20px; border-radius: 6px; border-left: 4px solid #f59e0b;">
    <p style="margin: 0; color: var(--gray-800);">
      <strong>ğŸ’¡ Notification preferences are only available for internal owners.</strong>
    </p>
    <p style="margin: 10px 0 0 0; color: var(--gray-600); font-size: 14px;">
      Contact your administrator if you need to be set up as an internal owner.
    </p>
  </div>
</div>
{% else %}

<div class="card" style="max-width: 600px;">
  <form method="POST" action="{{ url_for('save_notification_preferences') }}">
    
    <!-- Email Enabled Toggle -->
    <div class="form-group">
      <label style="display: flex; align-items: center; cursor: pointer; font-size: 16px;">
        <input type="checkbox" name="email_enabled" {% if prefs['EmailEnabled'] %}checked{% endif %} 
               style="width: auto; margin-right: 12px; transform: scale(1.2);">
        <span style="font-weight: 600;">Enable Email Reminders</span>
      </label>
      <p style="color: var(--gray-600); font-size: 14px; margin: 8px 0 0 32px;">
        Receive automatic reminders about your assigned RMAs
      </p>
    </div>
    
    <hr style="margin: 25px 0; border: none; border-top: 1px solid var(--gray-200);">
    
    <!-- Frequency Selection -->
    <div class="form-group">
      <label style="font-weight: 600; font-size: 15px; margin-bottom: 12px; display: block;">
        Reminder Frequency
      </label>
      <div style="display: flex; flex-direction: column; gap: 12px;">
        <label style="display: flex; align-items: center; cursor: pointer; padding: 12px; background-color: var(--gray-50); border-radius: 6px; border: 2px solid transparent; transition: border-color 0.2s;"
               onmouseover="this.style.borderColor='var(--primary)'" 
               onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='transparent'">
          <input type="radio" name="frequency" value="daily" 
                 {% if prefs['Frequency'] == 'daily' %}checked{% endif %} 
                 style="width: auto; margin-right: 12px;"
                 onchange="this.closest('label').style.borderColor='var(--primary)'">
          <div>
            <div style="font-weight: 600;">Daily</div>
            <div style="color: var(--gray-600); font-size: 13px;">Get reminded every day</div>
          </div>
        </label>
        
        <label style="display: flex; align-items: center; cursor: pointer; padding: 12px; background-color: var(--gray-50); border-radius: 6px; border: 2px solid transparent; transition: border-color 0.2s;"
               onmouseover="this.style.borderColor='var(--primary)'" 
               onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='transparent'">
          <input type="radio" name="frequency" value="every_3_days" 
                 {% if prefs['Frequency'] == 'every_3_days' %}checked{% endif %} 
                 style="width: auto; margin-right: 12px;">
          <div>
            <div style="font-weight: 600;">Every 3 Days</div>
            <div style="color: var(--gray-600); font-size: 13px;">Get reminded twice a week</div>
          </div>
        </label>
        
        <label style="display: flex; align-items: center; cursor: pointer; padding: 12px; background-color: var(--gray-50); border-radius: 6px; border: 2px solid transparent; transition: border-color 0.2s;"
               onmouseover="this.style.borderColor='var(--primary)'" 
               onmouseout="if(!this.querySelector('input').checked) this.style.borderColor='transparent'">
          <input type="radio" name="frequency" value="weekly" 
                 {% if prefs['Frequency'] == 'weekly' %}checked{% endif %} 
                 style="width: auto; margin-right: 12px;">
          <div>
            <div style="font-weight: 600;">Weekly</div>
            <div style="color: var(--gray-600); font-size: 13px;">Get reminded once a week</div>
          </div>
        </label>
      </div>
    </div>
    
    <hr style="margin: 25px 0; border: none; border-top: 1px solid var(--gray-200);">
    
    <!-- RMA Age Threshold - Custom Input -->
    <div class="form-group">
      <label style="font-weight: 600; font-size: 15px; margin-bottom: 8px; display: block;">
        Notify me about RMAs older than
      </label>
      <p style="color: var(--gray-600); font-size: 14px; margin: 0 0 12px 0;">
        Enter the number of days an RMA must be open before you want to be notified about it.
      </p>
      <div style="display: flex; align-items: center; gap: 10px;">
        <input type="number" name="rma_age" value="{{ prefs['RMAAge'] }}" 
               min="1" max="365" required
               style="width: 100px; padding: 10px; font-size: 18px; font-weight: 600; text-align: center; border: 2px solid var(--primary); border-radius: 6px;">
        <span style="font-weight: 600; color: var(--gray-700);">days</span>
      </div>
      <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
        <button type="button" onclick="document.querySelector('input[name=rma_age]').value=3" 
                class="btn-secondary" style="padding: 6px 12px; font-size: 13px;">3 days</button>
        <button type="button" onclick="document.querySelector('input[name=rma_age]').value=7" 
                class="btn-secondary" style="padding: 6px 12px; font-size: 13px;">7 days</button>
        <button type="button" onclick="document.querySelector('input[name=rma_age]').value=14" 
                class="btn-secondary" style="padding: 6px 12px; font-size: 13px;">14 days</button>
        <button type="button" onclick="document.querySelector('input[name=rma_age]').value=30" 
                class="btn-secondary" style="padding: 6px 12px; font-size: 13px;">30 days</button>
      </div>
    </div>
    
    {% if prefs['LastSent'] %}
    <div style="background-color: #f0f9ff; padding: 15px; border-radius: 6px; margin: 25px 0; border-left: 4px solid var(--primary);">
      <p style="margin: 0; font-size: 14px; color: var(--gray-700);">
        <strong>Last reminder sent:</strong> {{ prefs['LastSent']|short_date }}
      </p>
    </div>
    {% endif %}
    
    <div style="margin-top: 30px; display: flex; gap: 10px;">
      <button type="submit" class="btn-primary">ğŸ’¾ Save Preferences</button>
      <a href="{{ url_for('profile') }}" class="btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<!-- Example Section -->
<div class="card" style="max-width: 600px; margin-top: 20px; background-color: var(--gray-50);">
  <h4 style="margin-top: 0;">ğŸ“ Example</h4>
  <p style="color: var(--gray-700); margin: 0;">
    With your current settings, you will receive an email reminder 
    <strong>{{ prefs['Frequency'].replace('_', ' ') }}</strong> about RMAs that have been open for 
    <strong>{{ prefs['RMAAge'] }} days or more</strong>.
  </p>
</div>

{% endif %}

<style>
input[type="radio"]:checked + div {
  color: var(--primary);
}

label:has(input[type="radio"]:checked) {
  border-color: var(--primary) !important;
  background-color: #eff6ff !important;
}
</style>

{% endblock %}
